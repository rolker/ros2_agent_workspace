---
name: gather-project-knowledge
description: Scan workspace repos and generate project knowledge summaries for `.agents/workspace-context/`. Run this skill when already in a worktree for a knowledge-update issue on the target repo.
---

# Gather Project Knowledge

## Overview

Scan all project repos in the workspace, gather governance docs, agent guides,
and package metadata, then generate structured summaries. Output is written to
`.agents/workspace-context/` in the current repo so it can be shared across the
workspace via the `project_knowledge` symlink.

**Prerequisites**: You must already be in a worktree for a knowledge-update issue
on the repo where summaries should be written. This skill does not create issues,
worktrees, or PRs — it only generates and commits content.

## Workflow

### 1. Run the discovery script

```bash
.agent/scripts/discover_governance.sh --json
```

This produces a JSON-lines inventory of all governance documents across the
workspace and project repos.

### 2. Scan project repos for package metadata

For every project repo under `layers/main/*/src/`:

- List directories to identify packages
- Read `package.xml` files for package names, descriptions, and dependencies
- Read `.agents/README.md` if it exists (curated agent guide)
- Read `.agents/workspace-context/` contents if they exist (existing knowledge provider)
- Note the layer each repo belongs to

### 3. Generate summaries

Write the following files to `.agents/workspace-context/` in the current repo:

#### `workspace_overview.md`

High-level workspace inventory:

- Layer structure (which layers exist, what they contain)
- Package inventory table: repo, layer, packages, language, brief description
- Cross-repo relationships (shared dependencies, message types)
- Repos with governance docs vs repos without

#### `governance_summary.md`

Unified governance view organized by theme, not by repo:

- Workspace principles (from `docs/PRINCIPLES.md`) — short summary of each
- ADR index with one-line summaries and applicability
- Project-level principles (from any repo's `PRINCIPLES.md`) — note where
  they differ from or extend workspace principles
- Governance coverage: which repos have principles, ADRs, agent guides

#### `project_profiles/<repo>.md`

One file per project repo. For repos with an `.agents/README.md`, summarize it.
For repos without, generate a lightweight profile from the scan:

- Packages found (from `package.xml`)
- Language (C++ / Python / mixed — from `CMakeLists.txt` vs `setup.py`)
- Layer membership
- Key dependencies
- Whether governance docs exist
- Flag: "No `.agents/README.md` — consider creating one"

### 4. Add frontmatter to generated files

Every generated file should start with:

```markdown
<!-- Generated by gather-project-knowledge skill. Do not edit manually. -->
<!-- Regenerate by running this skill in a knowledge-update worktree. -->
<!-- Source: workspace at {workspace_repo_url} -->
<!-- Generated: {date} -->
```

### 5. Commit the changes

Stage all files in `.agents/workspace-context/` and commit with a message like:

```
Update project knowledge summaries

Scanned N repos across M layers. Found X packages.
Changes: [brief summary of what changed]
```

Report what was generated and what changed compared to the previous version.

## Output Structure

```
.agents/workspace-context/
├── workspace_overview.md
├── governance_summary.md
└── project_profiles/
    ├── unh_marine_autonomy.md
    ├── camp.md
    └── ...
```

## Guidelines

- **Verify against source** — every claim must come from actual files read during
  the scan. Do not guess package descriptions or dependencies.
- **Keep summaries concise** — the point is to save context window. A profile
  should be 20-50 lines, not a full reproduction of the source.
- **Flag gaps** — if a repo has no agent guide or no governance docs, note it.
  This helps prioritize documentation work.
- **Preserve existing content** — if `.agents/workspace-context/` already has
  hand-written files (not generated), do not overwrite them. Only update files
  with the generated-file frontmatter.
- **Respect other knowledge providers** — if a project repo has its own
  `.agents/workspace-context/`, read it as input but don't overwrite it.
  Summarize its content in the workspace-level view.
